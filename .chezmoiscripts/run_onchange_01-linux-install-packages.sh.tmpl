{{- if and (eq .chezmoi.os "linux") (eq .chezmoi.osRelease.id "arch") -}}
#!/bin/bash
set -euo pipefail

# pacman: {{ .packages.linux.arch.pacman | toJson | sha256sum }}
# aur: {{ .packages.linux.arch.aur | toJson | sha256sum }}
# flatpaks: {{ .packages.linux.flatpaks | toJson | sha256sum }}

echo "Installing pacman packages..."
sudo pacman -Syu --noconfirm --needed \
{{ range .packages.linux.arch.pacman -}}
    {{ . | quote }} \
{{ end }}

if ! flatpak remote-list | grep -q flathub; then
    echo "Adding Flathub remote..."
    flatpak remote-add --if-not-exists flathub https://dl.flathub.org/repo/flathub.flatpakrepo
fi

echo "Installing Flatpak packages..."
{{ range .packages.linux.flatpaks -}}
flatpak install -y flathub {{ . | quote }}
{{ end }}

echo "Installing AUR packages..."
if command -v yay &> /dev/null; then
{{ range .packages.linux.arch.aur -}}
    yay -S --noconfirm --needed {{ . | quote }}
{{ end }}
elif command -v paru &> /dev/null; then
{{ range .packages.linux.arch.aur -}}
    paru -S --noconfirm --needed {{ . | quote }}
{{ end }}
else
    echo "AUR helper (yay/paru) not found. Skipping AUR packages."
fi

echo "Package installation complete."
{{ end -}}
