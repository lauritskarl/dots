{{- if eq .chezmoi.os "windows" -}}
$ErrorActionPreference = "Stop"

# Packages hash: {{ .packages.windows | toJson | sha256sum }}

# Add buckets
Write-Host "Adding Scoop buckets..."
{{ range .packages.windows.buckets -}}
& "$env:USERPROFILE\scoop\shims\scoop.exe" bucket add {{ . }}
{{ end }}

# Install packages
Write-Host "Installing Scoop packages..."
$packages = @(
{{ range .packages.windows.scoop -}}
    {{ . | quote }}
{{ end -}}
)

foreach ($pkg in $packages) {
    & "$env:USERPROFILE\scoop\shims\scoop.exe" install $pkg
}

# Install fonts
Write-Host "Installing fonts..."
{{ range .packages.windows.fonts -}}
& "$env:USERPROFILE\scoop\shims\scoop.exe" install {{ . }}
{{ end }}

Write-Host "Package installation complete."
{{ end -}}
